# 권한 관리 - 신규 추가, 변경, 삭제 등


## 신규 권한 추가하기 - 채권2

### 작업 개요

- 작업 요청일: 2019-01-31
- 기존에 사용 중인 권한 목록에 새로운 권한을 추가한다.


### 요청 원문

```
요청자: 허자은  
  
안녕하세요

채권2 메뉴 개발 기획 중입니다.
채권2 메뉴를 볼 수 있는 고객을 설정하기 위한 권한 옵션 생성 부탁드려요. 

*CHECK CRM 에 권한 추가*  
crm.koscom.co.kr> 고객정보관리> 권한옵션  
권한옵션 설정창 분류: 메뉴, 제공기관: KOSCOM, 옵션명: 채권2 메뉴 (위치는  채권고급형 아래)  
권한구분: 권한있음/권한없음(디폴트 권한없음)  
유무상 구분은 필요없습니다.
```

### 작업 내용

1. 신규 옵션 코드값 설정 (`(2019)CRM_권한옵션관리_20190131.xlsm` 옵션 관리 엑셀 파일 참조)

    옵션명 | AUTH_NM | OPT_NO | GOODS_OPTION_CD
    ---- | ---- | ---- | ----
    채권2 | MENU | 18 | 76

    > **AUTH_NM, OPT_NO** 는 증권종합DB(HDB) CUST_OPTION_MAST 테이블에서 사용  
    > **GOODS_OPTION_CD** 는 MySQL에서 TN_GOODS_OPTIONS 테이블에서 사용

    > `권한옵션의 설정값은 MySQL DB와 증권종합DB의 동기화가 매우 중요하다.`

2. CHECK Client 접속 처리 쪽에 신규 옵션에 대한 정보 알려주고 처리 요청
    - 클라이언트 협력업체 이비아이앤씨 이용원씨에게 송신
        ```
        안녕하세요. 정보서비스팀 안지원입니다.  
        첨부와 같은 신규 권한옵션 추가 요청이 있어 다음과 같이 새 권한코드를 사용하려고 합니다.  
        CUST_OPTION_MAST
        - AUTH_NM = 'MENU'  
        - OPT_NO = 18  
        (권한명: '채권2')  
        현재 개발CRM 에서는 해당 데이터를 저장할 수 있게 해두었습니다.  
        클라이언트쪽 필요 작업 수행해 주시길 부탁드립니다.
        ```

    - 이비아이앤씨 한상민씨가 작업하여 회신
        ```
        안녕하세요  
        체크단말운용팀 한상민 입니다.  
        채권2 권한을 0000에서 확인 할 수 있도록 수정하여 개발(105)에 이행 하였습니다.  
        감사합니다.
        ```

    > CHEKC에서 화면번호 0000 을 입력하면 현 사용자의 보유 권한 내역을 볼 수 있다.



3. CRM 옵션 공통 코드 추가
    1. `관리자기능` - `공통코드관리` - 코드ID명 `'옵션'`으로 검색
    2. **COM072** `'옵션_명칭'` [ 관리 ] 클릭
    3. `'메뉴(001)'` - `'KOSCOM(00101)'` 클릭 후 `'하위코드등록'` 버튼 클릭
    4. 아래 정보와 같이 입력 후 `'등록저장'` 버튼 클릭

        코드 | 코드명 | 코드설명 | 정렬순서 | 옵션1 | 옵션2 | 옵션3  
        ---- | ---- | ---- | ---- | ---- | ---- | ----  
        76 | 채권2 | 채권2(20190131 추가) | 7 | 001 | MENU | 18

    5. `'내부용(7)', '비상주문(8)', '종가수신(9)'` 옵션 각각 선택하여 `정렬순서`에 +1 된 값으로 변경하고 `'수정'` 버튼 클릭하여 저장

4. 유무상구분은 필요하지 않다고 했으므로 `'채권2'` 권한의 유무상구분 select 태그는 보이지 않도록 변경
    * MngUpdateOptionPopup.jsp
    ```
	function setOpt76() {
		$("select#optList\\[76\\]\\.cmgrSeCd").hide();
	}

	$(document).ready(function () {	
		setOpt76(); //20190131 채권2 권한 추가 및 유무상구분 select 태그 삭제
        ...
    }
    ```

4. 정상 동작 여부 확인  
    * CRM - '`고객정보관리`' 메뉴에서 개별 고객 정보 클릭하여 '`권한옵션`' 탭 클릭 시 추가된 권한이 정상적으로 보이는지 확인  
    * '`권한옵션`' 탭에서 '`수정`' 버튼 클릭한 후 추가된 권한 정보에 대해 값 변경하여 저장 잘 되는지 확인
    * '`권한옵션`' 탭에서 '`수정`' 버튼 클릭한 후 추가된 권한 정보의 '`유무상구분`' 칸 내부의 select 태그는 표시되지 않는지 확인

<hr/>

## 권한 추가 - EMS 권한 추가

### 작업 개요

- 작업 요청일: 2018-12-28
- 기존에 있던 EMS 권한에, 선택 가능한 하위 항목을 추가한다.
- 기존에 사용하던 형태와 다른 부분이 있어서 수정이 약간 복잡하다.


### 요청 원문
```
요청자: 구상훈  
전달자: 김균형  
  
기존
권한없음 0
권한있음 1

변경 후
- 플랫폼 Platform -> 2
- 무료 Free -> 3
- 유료 Standard -> 4
- 프리미엄 Premiun -> 5

일단 4개 타입으로 해 주시면 되고, 추후 변경가능합니다.
향후 테스트와 시연은
CHECK Client(Test) - OMS(Test) 연결로 진행합니다. (양병운차장님께 확인한 내용입니다)
```

### 작업 내용

1.
COM072
기능(002)
KOSCOM(00202)
CHECK EMS(74)
옵션1 001 -> 004


2. 
COM071
메뉴권한_EMS(004) 추가
권한없음(401) - 옵션1 0
권한있음(402) - 옵션1 1
플랫폼Platform(403) - 옵션1 2
무료Free(404) - 옵션1 3
유료Standard(405) - 옵션1 4
프리미엄Premium(406) - 옵션1 5
그외 필요시 추가


3. JSP수정
- MngUpdateOptionPopup.jsp
- TabbedGoodsOptionView.jsp



## 기존 권한 변경하기 - 권한 통합 (Prebon, 환율 옵션)

### 작업 개요

- 최초 요청일: 2018-12-07
- 기존에 사용 중이던 권한 2종에 대해 각각 하위 권한 2개로 분리되어 있던 것을 1개로 

### 요청 원문
```
요청자: 이성훈  

To. 안지원 과장님,

  ㅇ개편요청서의 1단계만 확인해주면 되요. ('권한없음' 추가,   빨간색 으로 표기함)

  ㅇ현재 점검사항 중 반영안된 것으로 보이는 점 있는데 확인부탁해요.

     1)Tullet Prebon의 권한구분을 '종가'로 놓으면 '유무상구분'은 무조건 '무상'이 되어야함.
         →현재 개발에는 '금지표시'는 나오지만 '유상'으로 선택해도 저장이 됨
		 
		 
     2)개편요청서에 (Default)라고 되어 있는 것도 콤보리스트에 반영 부탁함
        → 非딜러:非딜러(Default) 로 .
            '종가' : '종가(Default)' 로.

 

To. 이용원 과장님,  

   2단계에 대한거 수정중이에요. 확정되면 재송부 할게요.  붉은색 으로 표기
```


### 작업 내용

2019-01-17
백엔드 이행 완료 후 옵션 데이터 일괄 변경 적용


2019-01-11
수정07 추가 요구사항

1. 채권고급형 권한 기보유 여부에 따른 Prebon 옵션 권한 부여
채권고급형: GOODS_OPTION_CD=6 , AUTO_NM='MENU' and OPT_NO=6

select g.GOODS_SQ, g.PID, o.GOODS_OPTION_CD, o.AUTHOR_SE_CD, o.CMGR_SE_CD
from
(select * from TN_GOODS_OPTIONS where GOODS_OPTION_CD=6) o left outer join
(select * from TN_GOODS where CNTRCT_STT_CD='001') g on o.GOODS_SQ=g.GOODS_SQ
where g.GOODS_SQ is not null;

2. 채권고급 설정에 따라 Prebon 옵션 권한은 기존 설정에서 예외가 되어 변경도 가능
"TR00000182","CPG1117001","CP43500017","CP20151118","TR00100502","TR81000002","RL00130004","RL00130001","CP22600011","CP22600010","CP22600009","CP22600008","CP20151116","CP20151115","CP20151114","CP81000001","TR00002201","CP52000010","CP52000007","CP52000001","CP52000006","CP52000004","CP47800001","CP44400001","CP44000002","CP44000001","CP43600001","CP43500011","TR00000410","CP43500016","CP43500015","CP43500014","CP43500013","CP43500012","CP43500010","CP43500001","CP22600003","CP22600002","CM01299903","CM01200001","CM01299902","CM01299901","TR00010185","PB05300001","CP38900001","PB00300201","MN91700001","MN01100101","MN92999901","MN91899903","MN91800001","MN91800002","TR00010507","RL00107801","RL00104802","RL00101910","RL10702102","RL10702101","RL00100804","RL10702003","RL00101906","RL00101911","RL10702001","RL00110001","RL00103301","RL00199915","RL10700101","RL00101913","RL10702002","RL10799901","RL00102201","RL00101909","RL00102502","RL00121001","RL10700005","RL10700003","RL10700002","RL00400201","RL00400108","RL00101102","RL00400102","RL00107901","RL00400101","RL00499901","RL00400106","RL00421302","RL00421304","RL00400104","RL00421303","RL00421301","RL00400501","RL00100404","RL00100401","RL00400110","RL00400105","RL00110005","RL00400107","RL00400112","RL00100101","RL00101103","RL00101203","RL00101206","RL00100803","RL00106001","RL00108101","RL00102401","RL00400116","RL00114511","RL00109701","RL00400115","RL00103501","RL00400117","RL00100502","RL00104004","RL00104005","RL00103001","RL00104006","RL00108001","RL00102501","RL00100807","RL00499902","RL00400203","RL00101105","RL00104804","RL00104803","RL00100801","RL00100802","RL00103101","RL00121103","RL00100901","RL00100201","RL00109201","RL00108201","RL00109001","RL00200901","RL00105001","RL00101101","RL00104601","RL00109401","RL00101802","RL00107001","RL00110010","RL00102301","RL00010051","RL00010050","RL00109802","RL00109803","RL00100301","RL00199907","RL10705001","RL00104401","RL00103302","RL00100110","RL00103401","RL00110003","RL00110008","RL00100102","RL00102001","RL00102101","RL00101905","RL00105301","RL00199917","RL00199916","RL00101912","CP08200002","CP08200001","PS00900003"

--====================================================================================================================================================
2018-12-04(화)

47 : 해외국채금리와 금리스왑 //권한없음, 종가, 실시간
48 : 삭제

51 : 달러-원 환율 (남김)
52 : 삭제


. 옵션 코드 수정 : COM072
해당 옵션 미사용 설정
남은 옵션 이름 변경


. 조회 화면 : TabbedGoodsOptionView
GoodsScrnController.java
옵션 목록 가져오는 방식 수정: 미사용 옵션은 가져오지 않음
Goods_SQL_mysql.xml <select id="goodsOptionList" ...></select>
USE_AT='Y'인 경우만 가져오기 (join 시에 적용)


. 수정 화면 : MngUpdateOptionPopup
  - 불필요한 선택지 숨기기

. 정상동작 여부 확인

/data/koscom/kc_crm/WEB-INF/classes/egovframework/sqlmap/kr/co/koscom/crm/Goods_SQL_mysql.xml
/data/koscom/kc_crm/WEB-INF/jsp/bos/crm/goods/MngUpdateOptionPopup.jsp/bos/crm/goods/MngUpdateOptionPopup




   
   
   


