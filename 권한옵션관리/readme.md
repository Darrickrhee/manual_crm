# 신규 권한 추가하기 - 채권2

## 작업 개요

- 작업 요청일: 2019-01-31
- 기존에 사용 중인 권한 목록에 새로운 권한을 추가한다.


## 요청 원문

```
안녕하세요

채권2 메뉴 개발 기획 중입니다.
채권2 메뉴를 볼 수 있는 고객을 설정하기 위한 권한 옵션 생성 부탁드려요. 

*CHECK CRM 에 권한 추가*  
crm.koscom.co.kr> 고객정보관리> 권한옵션  
권한옵션 설정창 분류: 메뉴, 제공기관: KOSCOM, 옵션명: 채권2 메뉴 (위치는  채권고급형 아래)  
권한구분: 권한있음/권한없음(디폴트 권한없음)  
유무상 구분은 필요없습니다.
```

## 작업 내용

1. 신규 옵션 코드값 설정 (`(2019)CRM_권한옵션관리_20190131.xlsm` 옵션 관리 엑셀 파일 참조)

    옵션명 | AUTH_NM | OPT_NO | GOODS_OPTION_CD
    ---- | ---- | ---- | ----
    채권2 | MENU | 18 | 76

    > **AUTH_NM, OPT_NO** 는 증권종합DB(HDB) CUST_OPTION_MAST 테이블에서 사용  
    > **GOODS_OPTION_CD** 는 MySQL에서 TN_GOODS_OPTIONS 테이블에서 사용

    > `권한옵션의 설정값은 MySQL DB와 증권종합DB의 동기화가 매우 중요하다.`

2. CHECK Client 접속 처리 쪽에 신규 옵션에 대한 정보 알려주고 처리 요청
    - 클라이언트 협력업체 이비아이앤씨 이용원씨에게 송신
        ```
        안녕하세요. 정보서비스팀 안지원입니다.  
        첨부와 같은 신규 권한옵션 추가 요청이 있어 다음과 같이 새 권한코드를 사용하려고 합니다.  
        CUST_OPTION_MAST
        - AUTH_NM = 'MENU'  
        - OPT_NO = 18  
        (권한명: '채권2')  
        현재 개발CRM 에서는 해당 데이터를 저장할 수 있게 해두었습니다.  
        클라이언트쪽 필요 작업 수행해 주시길 부탁드립니다.
        ```

    - 이비아이앤씨 한상민씨가 작업하여 회신
        ```
        안녕하세요  
        체크단말운용팀 한상민 입니다.  
        채권2 권한을 0000에서 확인 할 수 있도록 수정하여 개발(105)에 이행 하였습니다.  
        감사합니다.
        ```

    > CHEKC에서 화면번호 0000 을 입력하면 현 사용자의 보유 권한 내역을 볼 수 있다.



3. CRM 옵션 공통 코드 추가
    1. `관리자기능` - `공통코드관리` - 코드ID명 `'옵션'`으로 검색
    2. **COM072** `'옵션_명칭'` [ 관리 ] 클릭
    3. `'메뉴(001)'` - `'KOSCOM(00101)'` 클릭 후 `'하위코드등록'` 버튼 클릭
    4. 아래 정보와 같이 입력 후 `'등록저장'` 버튼 클릭

        코드 | 코드명 | 코드설명 | 정렬순서 | 옵션1 | 옵션2 | 옵션3  
        ---- | ---- | ---- | ---- | ---- | ---- | ----  
        76 | 채권2 | 채권2(20190131 추가) | 7 | 001 | MENU | 18

    5. `'내부용(7)', '비상주문(8)', '종가수신(9)'` 옵션 각각 선택하여 `정렬순서`에 +1 된 값으로 변경하고 `'수정'` 버튼 클릭하여 저장

4. 유무상구분은 필요하지 않다고 했으므로 `'채권2'` 권한의 유무상구분 select 태그는 보이지 않도록 변경
    * MngUpdateOptionPopup.jsp
    ```
	function setOpt76() {
		$("select#optList\\[76\\]\\.cmgrSeCd").hide();
	}

	$(document).ready(function () {	
		setOpt76(); //20190131 채권2 권한 추가 및 유무상구분 select 태그 삭제
        ...
    }
    ```

4. 정상 동작 여부 확인  
    * CRM - '`고객정보관리`' 메뉴에서 개별 고객 정보 클릭하여 '`권한옵션`' 탭 클릭 시 추가된 권한이 정상적으로 보이는지 확인  
    * '`권한옵션`' 탭에서 '`수정`' 버튼 클릭한 후 추가된 권한 정보에 대해 값 변경하여 저장 잘 되는지 확인
    * '`권한옵션`' 탭에서 '`수정`' 버튼 클릭한 후 추가된 권한 정보의 '`유무상구분`' 칸 내부의 select 태그는 표시되지 않는지 확인

<hr/>

# 권한 추가 - EMS 권한 추가

## 작업 개요

- 작업 요청일: 2018-12-28
- 기존에 있던 EMS 권한에, 선택 가능한 하위 항목을 추가한다.
- 기존에 사용하던 형태와 다른 부분이 있어서 수정이 약간 복잡하다.


## 요청 원문
```
기존
권한없음 0
권한있음 1

변경 후
- 플랫폼 Platform -> 2
- 무료 Free -> 3
- 유료 Standard -> 4
- 프리미엄 Premiun -> 5

일단 4개 타입으로 해 주시면 되고, 추후 변경가능합니다.
향후 테스트와 시연은
CHECK Client(Test) - OMS(Test) 연결로 진행합니다. (양병운차장님께 확인한 내용입니다)
```

## 작업 내용

[변경 내용]

1.
COM072
기능(002)
KOSCOM(00202)
CHECK EMS(74)
옵션1 001 -> 004


2. 
COM071
메뉴권한_EMS(004) 추가
권한없음(401) - 옵션1 0
권한있음(402) - 옵션1 1
플랫폼Platform(403) - 옵션1 2
무료Free(404) - 옵션1 3
유료Standard(405) - 옵션1 4
프리미엄Premium(406) - 옵션1 5
그외 필요시 추가


3. JSP수정
MngUpdateOptionPopup.jsp
TabbedGoodsOptionView.jsp
